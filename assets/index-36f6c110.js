import{d as G,r as x,N as M,c as Q,y as R,G as H,e as c,J as K,o as m,f as k,g as e,w as l,A as v,m as z,v as C,h as W,j as f,F as X,q as Y,t as I,B,z as D,O as Z,L as _,P as ee,Q as te}from"./index-f4238ceb.js";const ae=["onClick"],oe=G({__name:"index",setup(le){const y=x([]),i=x(0),p=M(),t=Q({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),b=x([]);R(()=>p.c3Id,()=>{y.value=[],p.c3Id&&V()});const V=async()=>{const{c1Id:a,c2Id:o,c3Id:g}=p,n=await te(a,o,g);console.log("属性值",n),n.code==200&&(y.value=n.data)},O=()=>{Object.assign(t,{attrName:"",attrValueList:[],categoryId:p.c3Id,categoryLevel:3}),i.value=1},S=a=>{i.value=1,Object.assign(t,JSON.parse(JSON.stringify(a)))},h=()=>{i.value=0},$=()=>{t.attrValueList.push({valueName:"",flag:!0}),D(()=>{b.value[t.attrValueList.length-1].focus()})},w=async()=>{const a=await Z(t);console.log("添加属性成功",a),a.code==200?(i.value=0,_({type:"success",message:t.id?"修改成功":"添加成功"}),V()):_({type:"error",message:t.id?"修改失败":"添加失败"})},U=(a,o)=>{if(a.valueName.trim()==""){t.attrValueList.splice(o,1),_({type:"error",message:"属性值不能为空"});return}if(t.attrValueList.find(n=>{if(n!=a)return n.valueName===a.valueName})){t.attrValueList.splice(o,1),_({type:"error",message:"属性值不能重复"});return}a.flag=!1},q=(a,o)=>{a.flag=!0,D(()=>{b.value[o].focus()})},E=async a=>{const o=await ee(a);console.log("删除成功",o),o.code==200?(_({type:"success",message:"删除成功"}),V()):_({type:"error",message:"删除失败"})};return H(()=>{p.$reset()}),(a,o)=>{const g=c("Category"),n=c("el-button"),d=c("el-table-column"),P=c("el-tag"),j=c("el-popconfirm"),L=c("el-table"),A=c("el-input"),J=c("el-form-item"),F=c("el-form"),T=c("el-card"),N=K("has");return m(),k("div",null,[e(g,{scene:i.value},null,8,["scene"]),e(T,{style:{margin:"10px 0px"}},{default:l(()=>[v(z("div",null,[v((m(),C(n,{type:"primary",size:"default",icon:"Plus",disabled:!W(p).c3Id,onClick:O},{default:l(()=>[f("添加属性")]),_:1},8,["disabled"])),[[N,"btn.Attr.add"]]),e(L,{style:{margin:"10px 0px"},border:"",data:y.value},{default:l(()=>[e(d,{label:"序号",type:"index",align:"center",width:"80px"}),e(d,{label:"属性名称",width:"120px",prop:"attrName"}),e(d,{label:"属性值名称"},{default:l(({row:s,$index:u})=>[(m(!0),k(X,null,Y(s.attrValueList,(r,ne)=>(m(),C(P,{key:r.id,style:{margin:"3px"}},{default:l(()=>[f(I(r.valueName),1)]),_:2},1024))),128))]),_:1}),e(d,{label:"操作",width:"130px"},{default:l(({row:s,$index:u})=>[v(e(n,{type:"warning",size:"default",icon:"Edit",onClick:r=>S(s)},null,8,["onClick"]),[[N,"btn.Attr.update"]]),e(j,{title:`确定删除${s.attrName}吗?`,onConfirm:r=>E(s.id),width:"170px",icon:"Delete","icon-color":"red","hide-after":10},{reference:l(()=>[v(e(n,{type:"danger",size:"default",icon:"Delete"},null,512),[[N,"btn.Attr.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[B,i.value==0]]),v(z("div",null,[e(F,{inline:""},{default:l(()=>[e(J,{label:"属性名称"},{default:l(()=>[e(A,{placeholder:"请输入属性名称",modelValue:t.attrName,"onUpdate:modelValue":o[0]||(o[0]=s=>t.attrName=s)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{type:"primary",size:"default",icon:"Plus",onClick:$,disabled:!t.attrName},{default:l(()=>[f("添加属性")]),_:1},8,["disabled"]),e(n,{type:"primary",size:"default",plain:"",onClick:h},{default:l(()=>[f("取消")]),_:1}),e(L,{border:"",style:{margin:"10px 0px"},data:t.attrValueList},{default:l(()=>[e(d,{label:"序号",type:"index",align:"center",width:"80px"}),e(d,{label:"属性值名称"},{default:l(({row:s,$index:u})=>[s.flag?(m(),C(A,{key:0,size:"default",placeholder:"请输入属性值名称",modelValue:s.valueName,"onUpdate:modelValue":r=>s.valueName=r,onBlur:r=>U(s,u),ref:r=>b.value[u]=r},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(m(),k("div",{key:1,onClick:r=>q(s,u)},I(s.valueName),9,ae))]),_:1}),e(d,{label:"属性值操作"},{default:l(({row:s,index:u})=>[e(n,{type:"danger",size:"default",icon:"Delete",onClick:r=>t.attrValueList.splice(u,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(n,{type:"primary",size:"default",onClick:w,disabled:!(t.attrValueList.length>0)},{default:l(()=>[f("保存")]),_:1},8,["disabled"]),e(n,{type:"primary",size:"default",plain:"",onClick:h},{default:l(()=>[f("取消")]),_:1})],512),[[B,i.value==1]])]),_:1})])}}});export{oe as default};
