import{I as w,d as Y,r as p,R as se,e as u,o as g,v as C,w as t,g as e,f as D,F as T,q as G,m as O,j as K,t as re,L as P,c as de,Q as ie,N as ce,y as pe,G as me,J as _e,A as F,h as ge,B as X}from"./index-f4238ceb.js";const ve=(v,k,f)=>w.get(`/admin/product/${v}/${k}?category3Id=${f}`),Z=()=>w.get("/admin/product/baseTrademark/getTrademarkList"),le=v=>w.get("/admin/product/spuImageList/"+v),te=v=>w.get("/admin/product/spuSaleAttrList/"+v),ee=()=>w.get("/admin/product/baseSaleAttrList"),fe=v=>v.id?w.post("/admin/product/updateSpuInfo",v):w.post("/admin/product/saveSpuInfo",v),Se=v=>w.post("/admin/product/saveSkuInfo",v),ye=v=>w.get("/admin/product/findBySpuId/"+v),be=v=>w.delete("/admin/product/deleteSpu/"+v),Ve=["src"],ke=Y({__name:"spuForm",emits:["changeScene"],setup(v,{expose:k,emit:f}){const U=()=>{f("changeScene",{flag:0,params:"update"})},x=p([]),A=p([]),s=p([]),h=p([]),m=p({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),q=p(!1),z=p(""),y=p(""),I=async l=>{m.value=l,console.log("SPU不完整数据获取成功",l);const a=await Z();console.log("SPU全部品牌数据获取成功",a);const n=await le(l.id);console.log("SPU品牌图片获取成功",n);const S=await te(l.id);console.log("SPU某一个品牌销售属性获取成功",S);const B=await ee();console.log("获取SPU全部的销售属性",B),x.value=a.data,A.value=n.data.map(L=>({name:L.imgName,url:L.imgUrl})),s.value=S.data,h.value=B.data},r=l=>{q.value=!0,z.value=l.url},d=()=>{},i=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<4?(P({type:"success",message:"上传文件成功"}),!0):(P({type:"error",message:"上传文件大小超过4M 请重新上传"}),!1):(P({type:"error",message:"上传文件格式必须为 PNG | JPG | GIF"}),!1),b=se(()=>h.value.filter(a=>s.value.every(n=>a.name!=n.saleAttrName))),N=()=>{const[l,a]=y.value.split(":"),n={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};s.value.push(n),y.value=""},E=l=>{l.flag=!0,l.saleAttrValue=""},_=l=>{const{baseSaleAttrId:a,saleAttrValue:n}=l,S={baseSaleAttrId:a,saleAttrValueName:n};if(n.trim()==""){P({type:"error",message:"属性值不能为空"});return}if(l.spuSaleAttrValueList.find(L=>L.saleAttrValueName==n)){P({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(S),l.flag=!1},c=async()=>{m.value.spuImageList=A.value.map(a=>({imgName:a.name,imgUrl:a.response&&a.response.data||a.url})),m.value.spuSaleAttrList=s.value,(await fe(m.value)).code?(P({type:"success",message:m.value.id?"更新成功":"添加成功"}),f("changeScene",{flag:0,params:m.value.id?"update":"add"})):P({type:"error",message:m.value.id?"更新失败":"添加失败"})};return k({initHasSpuData:I,initAddSpu:async l=>{Object.assign(m.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),A.value=[],s.value=[],y.value="",m.value.category3Id=l;const a=await Z(),n=await ee();x.value=a.data,h.value=n.data}}),(l,a)=>{const n=u("el-input"),S=u("el-form-item"),B=u("el-option"),L=u("el-select"),Q=u("Plus"),H=u("el-icon"),V=u("el-upload"),W=u("el-dialog"),$=u("el-button"),j=u("el-table-column"),ae=u("el-tag"),ne=u("el-table"),oe=u("el-form");return g(),C(oe,{"label-width":"100px"},{default:t(()=>[e(S,{label:"SPU名称"},{default:t(()=>[e(n,{placeholder:"请输入SPU名称",modelValue:m.value.spuName,"onUpdate:modelValue":a[0]||(a[0]=o=>m.value.spuName=o)},null,8,["modelValue"])]),_:1}),e(S,{label:"SPU品牌"},{default:t(()=>[e(L,{modelValue:m.value.tmId,"onUpdate:modelValue":a[1]||(a[1]=o=>m.value.tmId=o)},{default:t(()=>[(g(!0),D(T,null,G(x.value,(o,J)=>(g(),C(B,{key:o.id,label:o.tmName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"SPU描述"},{default:t(()=>[e(n,{type:"textarea",placeholder:"请输入SPU描述",modelValue:m.value.description,"onUpdate:modelValue":a[2]||(a[2]=o=>m.value.description=o)},null,8,["modelValue"])]),_:1}),e(S,{label:"SPU图标"},{default:t(()=>[e(V,{"file-list":A.value,"onUpdate:fileList":a[3]||(a[3]=o=>A.value=o),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":r,"on-remove":d,"before-upload":i},{default:t(()=>[e(H,null,{default:t(()=>[e(Q)]),_:1})]),_:1},8,["file-list"]),e(W,{modelValue:q.value,"onUpdate:modelValue":a[4]||(a[4]=o=>q.value=o)},{default:t(()=>[O("img",{"w-full":"",src:z.value,alt:"SPU商品图片",style:{width:"100%",height:"100%"}},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"SPU销售属性"},{default:t(()=>[e(L,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=o=>y.value=o),placeholder:b.value.length?`还有${b.value.length}个未选择`:"无"},{default:t(()=>[(g(!0),D(T,null,G(b.value,(o,J)=>(g(),C(B,{key:o.id,label:o.name,value:`${o.id}:${o.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e($,{type:"primary",icon:"Plus",style:{"margin-left":"10px"},disabled:!y.value,onClick:N},{default:t(()=>[K("添加属性")]),_:1},8,["disabled"]),e(ne,{border:"",style:{margin:"10px 0px"},data:s.value},{default:t(()=>[e(j,{label:"序号",type:"index",align:"center",width:"80px"}),e(j,{label:"销售属性名",width:"120px",prop:"saleAttrName"}),e(j,{label:"销售属性值"},{default:t(({row:o,$index:J})=>[(g(!0),D(T,null,G(o.spuSaleAttrValueList,(R,ue)=>(g(),C(ae,{key:R.id,onClose:xe=>o.spuSaleAttrValueList.splice(ue,1),class:"mx-1",closable:"",style:{margin:"0px 5px"}},{default:t(()=>[K(re(R.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag==!0?(g(),C(n,{key:0,modelValue:o.saleAttrValue,"onUpdate:modelValue":R=>o.saleAttrValue=R,onBlur:R=>_(o),placeholder:"请输入属性值",style:{width:"110px",margin:"6px"}},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(g(),C($,{key:1,type:"success",size:"small",icon:"Plus",onClick:R=>E(o)},null,8,["onClick"]))]),_:1}),e(j,{label:"操作",width:"120px"},{default:t(({row:o,$index:J})=>[e($,{type:"danger",size:"small",icon:"Delete",onClick:R=>s.value.splice(J,1)},{default:t(()=>[K("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(S,null,{default:t(()=>[e($,{type:"primary",onClick:c,disabled:!(s.value.length>0)},{default:t(()=>[K("保存")]),_:1},8,["disabled"]),e($,{type:"primary",plain:"",onClick:U},{default:t(()=>[K("取消")]),_:1})]),_:1})]),_:1})}}}),Ue=["src"],Ae=Y({__name:"skuForm",emits:["changeScene"],setup(v,{expose:k,emit:f}){const U=p(),x=p(),A=p(),s=de({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),h=p(),m=()=>{f("changeScene",{flag:0,params:""})},q=async(I,r,d)=>{s.category3Id=d.category3Id,s.spuId=d.id,s.tmId=d.tmId;const i=await ie(I,r,d.category3Id);console.log("平台属性获取成功",i);const b=await te(d.id);console.log("销售属性获取成功",b);const N=await le(d.id);console.log("照片墙获取成功",N),U.value=i.data,x.value=b.data,A.value=N.data},z=I=>{A.value.forEach(r=>{h.value.toggleRowSelection(r,!1)}),h.value.toggleRowSelection(I,!0),s.skuDefaultImg=I.imgUrl},y=async()=>{s.skuAttrValueList=U.value.reduce((r,d)=>{if(d.attrIdAndValueId){const[i,b]=d.attrIdAndValueId.split(":");r.push({attrId:i,valueId:b})}return r},[]),s.skuSaleAttrValueList=x.value.reduce((r,d)=>{if(d.saleIdAndValueId){const[i,b]=d.saleIdAndValueId.split(":");r.push({saleAttrId:i,saleAttrValueId:b})}return r},[]);const I=await Se(s);return console.log("添加SKU成功",I),I.code==200?(P({type:"success",message:"添加SKU成功"}),f("changeScene",{flag:0,params:""}),!0):(P({type:"error",message:"添加SKU失败"}),!1)};return k({initSkuData:q}),(I,r)=>{const d=u("el-input"),i=u("el-form-item"),b=u("el-option"),N=u("el-select"),E=u("el-form"),_=u("el-table-column"),c=u("el-button"),M=u("el-table");return g(),D("div",null,[e(E,{"label-width":"100px"},{default:t(()=>[e(i,{label:"SKU名称"},{default:t(()=>[e(d,{placeholder:"SKU名称",modelValue:s.skuName,"onUpdate:modelValue":r[0]||(r[0]=l=>s.skuName=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"价格(元)"},{default:t(()=>[e(d,{type:"number",placeholder:"价格(元)",modelValue:s.price,"onUpdate:modelValue":r[1]||(r[1]=l=>s.price=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"重量(克)"},{default:t(()=>[e(d,{placeholder:"重量(克)",modelValue:s.weight,"onUpdate:modelValue":r[2]||(r[2]=l=>s.weight=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"SKU描述"},{default:t(()=>[e(d,{type:"textarea",placeholder:"SKU描述",modelValue:s.skuDesc,"onUpdate:modelValue":r[3]||(r[3]=l=>s.skuDesc=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"平台属性"},{default:t(()=>[e(E,{inline:""},{default:t(()=>[(g(!0),D(T,null,G(U.value,(l,a)=>(g(),C(i,{key:l.id,label:l.attrName},{default:t(()=>[e(N,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":n=>l.attrIdAndValueId=n},{default:t(()=>[(g(!0),D(T,null,G(l.attrValueList,(n,S)=>(g(),C(b,{key:n.id,label:n.valueName,value:`${l.id}:${n.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(i,{label:"销售属性"},{default:t(()=>[e(E,{inline:""},{default:t(()=>[(g(!0),D(T,null,G(x.value,(l,a)=>(g(),C(i,{key:l.id,label:l.saleAttrName},{default:t(()=>[e(N,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":n=>l.saleIdAndValueId=n},{default:t(()=>[(g(!0),D(T,null,G(l.spuSaleAttrValueList,(n,S)=>(g(),C(b,{key:n.id,label:n.saleAttrValueName,value:`${l.id}:${n.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(i,{label:"图片名称"},{default:t(()=>[e(M,{border:"",data:A.value,ref_key:"table",ref:h},{default:t(()=>[e(_,{type:"selection",width:"80px",align:"center"}),e(_,{label:"图片"},{default:t(({row:l,$index:a})=>[O("img",{src:l.imgUrl,style:{width:"100px",height:"100px"}},null,8,Ue)]),_:1}),e(_,{label:"名称",prop:"imgName"}),e(_,{label:"操作"},{default:t(({row:l,$index:a})=>[e(c,{type:"warning",onClick:n=>z(l)},{default:t(()=>[K("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(i,null,{default:t(()=>[e(c,{type:"primary",onClick:y},{default:t(()=>[K("保存")]),_:1}),e(c,{type:"primary",plain:"",onClick:m},{default:t(()=>[K("取消")]),_:1})]),_:1})]),_:1})])}}}),Ie=["src"],Pe=Y({__name:"index",setup(v){const k=ce(),f=p(0),U=p(1),x=p(3),A=p([]),s=p(0),h=p(),m=p(),q=p([]),z=p(!1);pe(()=>k.c3Id,()=>{k.c3Id&&y()});const y=async(_=1)=>{U.value=_;const c=await ve(U.value,x.value,k.c3Id);console.log("SPU数据请求成功",c),c.code==200&&(A.value=c.data.records,s.value=c.data.total)},I=()=>{y()},r=()=>{f.value=1,h.value.initAddSpu(k.c3Id)},d=_=>{f.value=_.flag,_.params=="update"?y(U.value):y()},i=_=>{f.value=1,h.value.initHasSpuData(_)},b=_=>{f.value=2,m.value.initSkuData(k.c1Id,k.c2Id,_)},N=async _=>{const c=await ye(_.id);c.code==200&&(q.value=c.data,z.value=!0)},E=async _=>{(await be(_.id)).code==200?(P({type:"success",message:"SPU删除成功"}),y(A.value.length>1?U.value:U.value-1)):P({type:"error",message:"SPU删除失败"})};return me(()=>{k.$reset()}),(_,c)=>{const M=u("Category"),l=u("el-button"),a=u("el-table-column"),n=u("el-popconfirm"),S=u("el-table"),B=u("el-pagination"),L=u("el-dialog"),Q=u("el-card"),H=_e("has");return g(),D("div",null,[e(M,{scene:f.value},null,8,["scene"]),e(Q,{style:{margin:"10px 0px"}},{default:t(()=>[F(O("div",null,[F((g(),C(l,{type:"primary",size:"default",icon:"Plus",disabled:!ge(k).c3Id,onClick:r},{default:t(()=>[K("添加SPU")]),_:1},8,["disabled"])),[[H,"btn.Spu.add"]]),e(S,{style:{margin:"10px 0px"},border:"",data:A.value},{default:t(()=>[e(a,{label:"序号",type:"index",align:"center",width:"80px"}),e(a,{label:"SPU名称",prop:"spuName"}),e(a,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(a,{label:"SPU操作"},{default:t(({row:V,$index:W})=>[F(e(l,{type:"primary",icon:"Plus",title:"添加SKU",onClick:$=>b(V)},null,8,["onClick"]),[[H,"btn.Spu.addsku"]]),F(e(l,{type:"warning",icon:"Edit",title:"修改SPU",onClick:$=>i(V)},null,8,["onClick"]),[[H,"btn.Spu.update"]]),F(e(l,{type:"info",icon:"WarningFilled",title:"查看SPU列表",onClick:$=>N(V)},null,8,["onClick"]),[[H,"btn.Spu.skus"]]),e(n,{title:`确定删除${V.spuName}吗?`,onConfirm:$=>E(V),width:"170px",icon:"Delete","icon-color":"red","hide-after":10},{reference:t(()=>[F(e(l,{type:"danger",icon:"Delete",title:"删除SPU"},null,512),[[H,"btn.Spu.delete"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(B,{"current-page":U.value,"onUpdate:currentPage":c[0]||(c[0]=V=>U.value=V),"page-size":x.value,"onUpdate:pageSize":c[1]||(c[1]=V=>x.value=V),"page-sizes":[2,5,6,10],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:s.value,onCurrentChange:y,onSizeChange:I},null,8,["current-page","page-size","total"])],512),[[X,f.value==0]]),F(e(ke,{onChangeScene:d,ref_key:"spu",ref:h},null,512),[[X,f.value==1]]),F(e(Ae,{onChangeScene:d,ref_key:"sku",ref:m},null,512),[[X,f.value==2]]),e(L,{title:"SKU列表",modelValue:z.value,"onUpdate:modelValue":c[2]||(c[2]=V=>z.value=V)},{default:t(()=>[e(S,{border:"",data:q.value},{default:t(()=>[e(a,{label:"SKU名称",prop:"skuName"}),e(a,{label:"SKU价格",prop:"price"}),e(a,{label:"SKU重量",prop:"weight"}),e(a,{label:"SKU图片"},{default:t(({row:V,$index:W})=>[O("img",{src:V.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Ie)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Pe as default};
