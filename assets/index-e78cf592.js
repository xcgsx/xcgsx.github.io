import{I as w,d as ie,r as d,c as ce,D as pe,e as c,J as me,o as v,f as T,g as l,w as a,K as ve,j as u,A as R,v as b,m as B,t as F,n as fe,F as ge,q as _e,z as M,L as g,p as ye,k as be,_ as we}from"./index-f4238ceb.js";import{u as Ve}from"./setting-5dde2129.js";const he=(s,i,h)=>w.get(`/admin/acl/user/${s}/${i}/?username=${h}`),Ce=s=>s.id?w.put("/admin/acl/user/update",s):w.post("/admin/acl/user/save",s),Ue=s=>w.get("/admin/acl/user/toAssign/"+s),ke=s=>w.post("/admin/acl/user/doAssignRole",s),xe=s=>w.delete("/admin/acl/user/remove/"+s),Se=s=>w.delete("/admin/acl/user/batchRemove",{data:s}),Re=s=>(ye("data-v-8ad59d2a"),s=s(),be(),s),qe=Re(()=>B("h4",null,"分配用户角色",-1)),ze=ie({__name:"index",setup(s){const i=d(1),h=d(3),D=d(),q=d([]),V=d(!1),C=d(!1),n=ce({username:"",name:"",password:""}),_=d(),U=d([]),k=d([]),z=d(!1),I=d(!0),$=d([]),x=d(""),N=Ve();pe(()=>{f()});const f=async(o=1)=>{i.value=o;const e=await he(i.value,h.value,x.value);console.log("用户信息数据获取成功",e),e.code==200&&(D.value=e.data.total,q.value=e.data.records)},H=()=>{f()},J=()=>{V.value=!1},G=()=>{V.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""}),M(()=>{_.value.clearValidate("username"),_.value.clearValidate("name"),_.value.clearValidate("password")})},Q=o=>{V.value=!0,Object.assign(n,o),M(()=>{_.value.clearValidate("username"),_.value.clearValidate("name")})},W=async()=>{await _.value.validate();const o=await Ce(n);console.log("添加或修改用户信息",o),o.code==200?(V.value=!1,g({type:"success",message:n.id?"更新成功":"添加成功"}),f(n.id?i.value:1),window.location.reload()):g({type:"error",message:n.id?"更新失败":"添加失败"})},X={username:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=6?r():r(new Error("用户密码至少六位"))}}]},Y=async o=>{Object.assign(n,o);const e=await Ue(n.id);console.log("角色职位获取成功",e),e.code==200&&(C.value=!0,U.value=e.data.allRolesList,k.value=e.data.assignRoles)},Z=o=>{k.value=o?U.value:[],I.value=!1},ee=o=>{z.value=o.length===U.value.length,I.value=o.length!==U.value.length},le=async()=>{const o={userId:n.id,roleIdList:k.value.map(r=>r.id)},e=await ke(o);console.log(e),e.code==200?(g({type:"success",message:"分配角色成功"}),C.value=!1,f(i.value)):g({type:"error",message:"分配角色失败"})},ae=async o=>{const e=await xe(o);console.log(e),e.code==200?(g({type:"success",message:"删除成功"}),f(q.value.length>1?i.value:i.value-1)):g({type:"error",message:"删除失败"})},te=o=>{$.value=o},oe=async()=>{const o=$.value.map(r=>r.id),e=await Se(o);console.log(e),e.code==200?(g({type:"success",message:"批量删除成功"}),f(q.value.length>1?i.value:i.value-1)):g({type:"error",message:"批量删除失败"})},E=()=>{f(),x.value=""},ne=()=>{N.refsh=!N.refsh};return(o,e)=>{const r=c("el-input"),y=c("el-form-item"),p=c("el-button"),A=c("el-form"),L=c("el-card"),m=c("el-table-column"),se=c("el-popconfirm"),re=c("el-table"),de=c("el-pagination"),j=c("el-drawer"),O=c("el-checkbox"),ue=c("el-checkbox-group"),S=me("has");return v(),T("div",null,[l(L,{style:{height:"80px"}},{default:a(()=>[l(A,{inline:"",class:"form"},{default:a(()=>[l(y,{label:"用户名"},{default:a(()=>[l(r,{placeholder:"请输入用户名 - 回车搜索",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),onKeyup:ve(E,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(y,null,{default:a(()=>[l(p,{type:"primary",disabled:!x.value,onClick:E},{default:a(()=>[u("搜索")]),_:1},8,["disabled"]),l(p,{type:"primary",plain:"",onClick:ne},{default:a(()=>[u("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(L,{style:{margin:"10px 0px"}},{default:a(()=>[R((v(),b(p,{type:"primary",onClick:G},{default:a(()=>[u("添加用户")]),_:1})),[[S,"btn.User.add"]]),R((v(),b(p,{type:"danger",disabled:!$.value.length,onClick:oe},{default:a(()=>[u("批量删除")]),_:1},8,["disabled"])),[[S,"btn.User.remove"]]),l(re,{style:{margin:"10px 0px"},border:"",data:q.value,onSelectionChange:te},{default:a(()=>[l(m,{type:"selection",align:"center"}),l(m,{label:"#",align:"center",type:"index"}),l(m,{label:"ID",align:"center",prop:"id"}),l(m,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(m,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(m,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(m,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(m,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(m,{label:"操作",width:"265px",align:"center"},{default:a(({row:t,$index:K})=>[R((v(),b(p,{type:"primary",size:"small",icon:"User",onClick:P=>Y(t)},{default:a(()=>[u("分配角色")]),_:2},1032,["onClick"])),[[S,"btn.User.assgin"]]),R((v(),b(p,{type:"info",size:"small",icon:"Edit",onClick:P=>Q(t)},{default:a(()=>[u("编辑")]),_:2},1032,["onClick"])),[[S,"btn.User.update"]]),l(se,{title:`确定删除${t.username}吗?`,onConfirm:P=>ae(t.id),width:"260px",icon:"Delete","icon-color":"red","hide-after":10},{reference:a(()=>[R((v(),b(p,{type:"danger",size:"small",icon:"Delete"},{default:a(()=>[u("删除")]),_:1})),[[S,"btn.User.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(de,{"current-page":i.value,"onUpdate:currentPage":e[1]||(e[1]=t=>i.value=t),"page-size":h.value,"onUpdate:pageSize":e[2]||(e[2]=t=>h.value=t),"page-sizes":[3,5,6,10],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:D.value,onCurrentChange:f,onSizeChange:H},null,8,["current-page","page-size","total"])]),_:1}),l(j,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=t=>V.value=t)},{header:a(()=>[B("h4",null,F(n.id?"编辑用户":"添加用户"),1)]),default:a(()=>[l(A,{model:n,rules:X,ref_key:"formRef",ref:_},{default:a(()=>[l(y,{label:"用户姓名",prop:"username"},{default:a(()=>[l(r,{placeholder:"请输入用户姓名",modelValue:n.username,"onUpdate:modelValue":e[3]||(e[3]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),l(y,{label:"用户昵称",prop:"name"},{default:a(()=>[l(r,{placeholder:"请输入用户昵称",modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=t=>n.name=t)},null,8,["modelValue"])]),_:1}),n.id?fe("",!0):(v(),b(y,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(r,{placeholder:"请输入用户密码",modelValue:n.password,"onUpdate:modelValue":e[5]||(e[5]=t=>n.password=t)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:a(()=>[l(p,{type:"primary",plain:"",onClick:J},{default:a(()=>[u("取消")]),_:1}),l(p,{type:"primary",onClick:e[6]||(e[6]=t=>W(o.row))},{default:a(()=>[u("确定")]),_:1})]),_:1},8,["modelValue"]),l(j,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=t=>C.value=t)},{header:a(()=>[qe]),default:a(()=>[l(A,null,{default:a(()=>[l(y,{label:"用户姓名"},{default:a(()=>[l(r,{modelValue:n.username,"onUpdate:modelValue":e[8]||(e[8]=t=>n.username=t),disabled:!0},null,8,["modelValue"])]),_:1}),l(y,{label:"角色列表"},{default:a(()=>[l(O,{modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=t=>z.value=t),indeterminate:I.value,onChange:Z},{default:a(()=>[u("全选")]),_:1},8,["modelValue","indeterminate"]),l(ue,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=t=>k.value=t),onChange:ee},{default:a(()=>[(v(!0),T(ge,null,_e(U.value,(t,K)=>(v(),b(O,{key:K,label:t},{default:a(()=>[u(F(t.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:a(()=>[l(p,{type:"primary",plain:"",onClick:e[11]||(e[11]=t=>C.value=!1)},{default:a(()=>[u("取消")]),_:1}),l(p,{type:"primary",onClick:le},{default:a(()=>[u("确定")]),_:1})]),_:1},8,["modelValue"])])}}});const Ee=we(ze,[["__scopeId","data-v-8ad59d2a"]]);export{Ee as default};
